-- ðŸŒ¿ ESP Aura + Beam + Overhead hiá»ƒn thá»‹ DisplayName + Generation + Floor (auto update)
-- âš™ï¸ By PhatLee (custom version)
-- âœ… Cáº­p nháº­t liÃªn tá»¥c 0.1s, lá»c >10M/s, bá» qua model/friendpanel, bá» qua plot chá»©a tá»« khÃ³a, bá» qua generation cho model Ä‘áº·c biá»‡t

local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- ðŸ’¡ Cáº¥u hÃ¬nh mÃ u
local AURA_COLOR = Color3.fromRGB(0, 255, 100)

-- âš™ï¸ Danh sÃ¡ch tá»« khÃ³a bá»‹ cháº·n
local BLOCKED_KEYWORDS = {
	"sweet",
	"datqitprosunshine",
	"hiepga",
}

-- âš™ï¸ Danh sÃ¡ch model luÃ´n ESP (bá» qua condition generation)
local ALWAYS_ESP_MODELS = {
	"67",
	"Pot Hotspot",
	-- thÃªm tÃªn model muá»‘n bá» qua generation á»Ÿ Ä‘Ã¢y
}

-- ðŸ§© HÃ m chuyá»ƒn "10K/s", "3.2M/s", "1B/s" thÃ nh sá»‘
local function parseGeneration(text)
	if not text or type(text) ~= "string" then return 0 end
	text = text:upper():gsub("/S", "")
	local num = tonumber(text:match("[%d%.]+")) or 0
	if text:find("K") then
		num *= 1_000
	elseif text:find("M") then
		num *= 1_000_000
	elseif text:find("B") then
		num *= 1_000_000_000
	end
	return num
end

-- ðŸ§© XÃ¡c Ä‘á»‹nh floor tá»« model podium
local function getFloorFromModel(model)
	if not model or not model:IsA("Model") then return "Unknown Floor" end
	local num = tonumber(model.Name:match("^(%d+)"))
	if num then
		if num >= 1 and num <= 10 then
			return "1st Floor"
		elseif num >= 11 and num <= 18 then
			return "2nd Floor"
		else
			return "3rd Floor"
		end
	end
	return "Unknown Floor"
end

-- ðŸ§© ESP Aura
local function createAura(model)
	if not model or not model:IsA("Model") then return end
	if model.Name == "model" or model.Name == "friendpanel" then return end
	if model:FindFirstChild("ESP_Aura") then return end

	local highlight = Instance.new("Highlight")
	highlight.Name = "ESP_Aura"
	highlight.FillTransparency = 1
	highlight.OutlineTransparency = 0
	highlight.OutlineColor = AURA_COLOR
	highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
	highlight.Adornee = model
	highlight.Parent = model
end

-- ðŸ§© Beam tá»« ngÆ°á»i chÆ¡i â†’ Model
local function createBeam(model)
	if not model or not model:IsA("Model") then return end
	if model.Name == "model" or model.Name == "friendpanel" then return end
	if model:FindFirstChild("ESP_Beam") then return end

	local primary = model:FindFirstChildWhichIsA("BasePart") or model.PrimaryPart
	if not primary then return end
	local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	if not hrp then return end

	local folder = Instance.new("Folder", model)
	folder.Name = "ESP_BeamFolder"

	local a0 = Instance.new("Attachment")
	a0.Name = "A0"
	a0.Parent = hrp

	local a1 = Instance.new("Attachment")
	a1.Name = "A1"
	a1.Parent = primary

	local beam = Instance.new("Beam")
	beam.Name = "ESP_Beam"
	beam.Attachment0 = a0
	beam.Attachment1 = a1
	beam.Color = ColorSequence.new(AURA_COLOR)
	beam.Width0 = 0.06
	beam.Width1 = 0.06
	beam.LightEmission = 1
	beam.Transparency = NumberSequence.new(0)
	beam.FaceCamera = true
	beam.Parent = folder
end

-- ðŸ§© Overhead hiá»ƒn thá»‹ DisplayName + Generation + Floor
local function attachOverhead(model, displayText, generationText, floorText)
	if not model or not model:IsA("Model") then return end
	if model.Name == "model" or model.Name == "friendpanel" then return end

	local primary = model:FindFirstChildWhichIsA("BasePart") or model.PrimaryPart
	if not primary then return end

	local gui = primary:FindFirstChild("OverheadGui")
	if not gui then
		gui = Instance.new("BillboardGui")
		gui.Name = "OverheadGui"
		gui.Adornee = primary
		gui.Size = UDim2.new(0, 200, 0, 75)
		gui.StudsOffset = Vector3.new(0, 4, 0)
		gui.AlwaysOnTop = true
		gui.Parent = primary

		-- DisplayName
		local nameLabel = Instance.new("TextLabel")
		nameLabel.Name = "NameLabel"
		nameLabel.Size = UDim2.new(1, 0, 0.33, 0)
		nameLabel.BackgroundTransparency = 1
		nameLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
		nameLabel.TextScaled = true
		nameLabel.Font = Enum.Font.GothamBold
		nameLabel.Parent = gui

		-- Generation
		local genLabel = Instance.new("TextLabel")
		genLabel.Name = "GenLabel"
		genLabel.Size = UDim2.new(1, 0, 0.33, 0)
		genLabel.Position = UDim2.new(0, 0, 0.33, 0)
		genLabel.BackgroundTransparency = 1
		genLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
		genLabel.TextScaled = true
		genLabel.Font = Enum.Font.GothamSemibold
		genLabel.Parent = gui

		-- Floor
		local floorLabel = Instance.new("TextLabel")
		floorLabel.Name = "FloorLabel"
		floorLabel.Size = UDim2.new(1, 0, 0.33, 0)
		floorLabel.Position = UDim2.new(0, 0, 0.66, 0)
		floorLabel.BackgroundTransparency = 1
		floorLabel.TextColor3 = Color3.fromRGB(0, 150, 255)
		floorLabel.TextScaled = true
		floorLabel.Font = Enum.Font.GothamSemibold
		floorLabel.Parent = gui
	end

	-- Update text liÃªn tá»¥c
	gui.NameLabel.Text = displayText
	gui.GenLabel.Text = generationText
	gui.FloorLabel.Text = floorText or "Unknown Floor"
end

-- ðŸ§© Kiá»ƒm tra plot bá»‹ cháº·n
local function isPlotBlocked(plot)
	local plotSign = plot:FindFirstChild("PlotSign")
	if not plotSign then return false end

	local surf = plotSign:FindFirstChild("SurfaceGui")
	local frame = surf and surf:FindFirstChild("Frame")
	local label = frame and frame:FindFirstChild("TextLabel")
	if not label or not label.Text then return false end

	local text = string.lower(label.Text)
	for _, keyword in pairs(BLOCKED_KEYWORDS) do
		if string.find(text, string.lower(keyword)) then
			return true
		end
	end
	return false
end

-- ðŸ§© Xá»­ lÃ½ plot liÃªn tá»¥c
local function processPlots()
	for _, plot in pairs(Workspace:WaitForChild("Plots"):GetChildren()) do
		if isPlotBlocked(plot) then
			continue
		end

		local podiums = plot:FindFirstChild("AnimalPodiums")
		if podiums then
			for _, podium in pairs(podiums:GetChildren()) do
				local base = podium:FindFirstChild("Base")
				local spawn = base and base:FindFirstChild("Spawn")
				if spawn and spawn:FindFirstChild("Attachment") then
					local overhead = spawn.Attachment:FindFirstChild("AnimalOverhead")
					if overhead then
						local displayName = overhead:FindFirstChild("DisplayName")
						local generation = overhead:FindFirstChild("Generation")

						if displayName and generation and displayName:IsA("TextLabel") and generation:IsA("TextLabel") then
							local targetName = displayName.Text
							local genValue = parseGeneration(generation.Text)

							-- Kiá»ƒm tra bá» qua generation náº¿u model trong ALWAYS_ESP_MODELS
							local ignoreGen = false
							for _, name in pairs(ALWAYS_ESP_MODELS) do
								if targetName == name then
									ignoreGen = true
									break
								end
							end

							if genValue > 10_000_000 or ignoreGen then
								for _, model in pairs(plot:GetChildren()) do
									if model:IsA("Model") and model.Name == targetName then
										local floor = getFloorFromModel(podium)
										createAura(model)
										createBeam(model)
										attachOverhead(model, displayName.Text, generation.Text, floor)
									end
								end
							end
						end
					end
